<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link href="websiteCSS.css" rel="stylesheet" type="text/css">
    <script src="jquery-2.1.1.min.js" type="text/javascript"></script>
    <script type="text/javascript">
$(document).ready(function() {
    //Set up a global variable for storing the function to be performed
    storedOperator = null;
    //Set up a global variable for whether the next operand input is a new number, or if it
    //should be appended to the current number.
    nextInputIsNewNumber = true;
    //Set up a global variable for storing the first operand to use in functions.
    storedOperand = 0;
    //Set the initial value of the calculator window.
    $("#calcWindow").val(0);


    /**
    * An event handler for whenever the user clicks a button of class operand.
    * If this input is supposed to be a new number, simply assigns the value
    * of the operand to the calculator window.
    * Otherwise, it appends this value to the current value, as long as the length
    * is less than 8, so the new length can be no more than 8.
    */
    $(".operand").click(function() {

        if(nextInputIsNewNumber) {
            nextInputIsNewNumber = false;
            $("#calcWindow").val($(this).val());
        }
        else {
            if($("#calcWindow").val().length < 8) {
                $("#calcWindow").val($("#calcWindow").val() + $(this).val());
            }
        }       
     });    
     
     /**
     * An event handler for whenever the use clicks a button of class operator.
     * This is a very complex function, so there are more informative comments above their relevant sections.
     */
    $(".operator").click(function() {
     /*If the calculator display is currently blank, then that means it was just cleared
     * by the entering of an operator, if this operator is not the = operator, then we simply
     * overwrite the operator stored in memory. If the operator entered WAS 0, then
     * the user wants a semantic calculator function where entering no second operand uses the
     * first operand as the second also, such as 7*= 49, so we call the function performCalculation
     * using the operand stored in memory as both operands, and the stored operator.
     * If no operator has been stored, then we just display 0 as no calculation has been asked.
     */
        if($("#calcWindow").val() == "" ) {
            if($(this).val() != "=" ) {
                storedOperator = $(this).val();
            }
            else {
                if(storedOperator != null) {
                    performCalculation(storedOperand, storedOperand, storedOperator);
                    nextInputIsNewNumber = true;
                    storedOperator = null;
                }
                else {
                    $("#calcWindow").val(0);
                    nextInputIsNewNumber = true;
                }
            }
        }
        else {
            /**
            * In this case, the calculator window has a value, so the first thing we do
            * when a user clicks an operator is store the current value displayed by the calculator
            * as the first operand to operate upon, currentOperand.
            */
            currentOperand = $("#calcWindow").val();
            /**
            * If the storedOperator is not null, that is to say the user has entered an operator before,
            * clicking this operator, that means we have a result to calculate. Therefore after checking
            * the user is not trying to divide by 0, we call performCalculation() on the operand stored
            * in memory, storedOperand as the first operand, and the value currently displayed by 
            * the calculator as the second operand, and the operator currently stored in memory.
            * If the value of the operator button pressed was not =, then we know we have another operator
            * to store so we can perform calculations once the next operator is pressed, so that we overwrite
            * the storedOperator in memory. If the user clicked =, then we consider that the end of the "string"
            * of operations to perform, and set storedOperator as null. We then set nextInputIsNewNumber to true
            * as the next operand to be entered is a new operand.
            */
            if(storedOperator != null) {
                if(storedOperator == "/" && currentOperand == 0) {
                    
                    storedOperator = null;
                    storedOperand = 0;
                    $("#calcWindow").val("DIVBY0");
                }
                else  {
                    performCalculation(storedOperand, currentOperand, storedOperator);
                    if($(this).val() != "=") {
                        storedOperator = $(this).val();
                    }
                    else {
                        storedOperator = null;
                    }
                }
                nextInputIsNewNumber = true;    
            }
            /**
            * If the stored operator has not been set, then we store the current value of the display
            * in memory as the first operand to operate upon, set the operator stored in memory to
            * the value of the operator button that was just pressed. If the user pressed =,
            * then we do nothing as there is no calculation to calculate.
            */
            else if(storedOperator == null) {
                    if($(this).val() != "=") {
                        storedOperator = $(this).val();
                        storedOperand = $("#calcWindow").val();
                        $("#calcWindow").val("");
                    }
                
            }   
        }
     });
     /**
     * An event handler that handles input of C, or resetting the calculator.
     * All this does is reset all the variables to their initial states, 
     * and resets the calculator window display to 0.
     */
     $("#C").click(function() {
        storedOperator = null;
        storedOperand = 0;
        nextInputIsNewNumber = true;
        $("#calcWindow").val(0);
     });
     /**
     * An event handler that clears only the current entry,
     * which means it resets the calculators display,
     * and sets nextInputIsNewNumber to true,
     * as the next operand input is now a new number.
     */
     $("#CE").click(function() {
        $("#calcWindow").val(0);
        nextInputIsNewNumber = true;
     });
     
     /**
     * This is a function that performs the calculations, and then gets the string 
     * that represents that calculation,and sets the calculators display to that, 
     * so that it displays the result of the calculation,
     * and keeps the result of the calculation in memory to operate on further.
     * It also includes error handling for whether the result calculation is too big.
     * @param firstOperand The operand stored in memory, the first value to operate upon.
     * @param secondOperand The current value of the calculator window, the second value to operate upon.
     * @param operator The operator stored in memory, the function to apply to the values.
     */
     function performCalculation(firstOperand, secondOperand, operator) {
                            switch(operator) {
                            case "+":
                                data = new Number(firstOperand) + new Number(secondOperand);
                                break;
                            case "-":
                                data = new Number(firstOperand) - new Number(secondOperand);
                                break;
                            case "/":
                                data = new Number(firstOperand) / new Number(secondOperand);
                                break;
                            case "*":
                                data = new Number(firstOperand) * new Number(secondOperand);
                                break;
                            }
                            data = new String(data);
                            var returnValue;
                            if(data.indexOf(".") > -1) {
                                var lengthBeforePoint = data.indexOf(".");
                                returnValue = new Number(data)  
                                if(lengthBeforePoint > 8) {
                                    lengthBeforePoint = 8;
                                }                               
                                $("#calcWindow").val(returnValue.toFixed(8 - lengthBeforePoint));
                                storedOperand = returnValue.toFixed(8 - lengthBeforePoint);
                            }
                            else if(data.length < 9) {
                                returnValue = data;
                                $("#calcWindow").val(returnValue);
                                storedOperand = returnValue;
                            }
                            else {
                                $("#calcWindow").val("OVERFLOW");
                                storedOperand = 0;
                                storedOperator = null;
                            }
                
     }
    });
    </script>

    <title>Web Calculator</title>
</head>

<body>
    <div id="nav-bar">
        <a href="index.html">Home</a> &nbsp;| <a href=
        "random_choice_selector.html">Random Choice Selector</a> &nbsp;|
        <a href=
        "floating_point_calculator.html">Floating Point Calculator</a>
    </div>

    <h1>Sam's Floating Point Calculator</h1>

    <div id="calculator">
        <textarea id="calcWindow" readonly rows="1" style="resize:none;">
</textarea><br>
        <button class="operand" name='1' type="button" value='1'>1</button>
        <button class="operand" name='2' type="button" value='2'>2</button>
        <button class="operand" name='3' type="button" value='3'>3</button><br>
        <button class="operand" name='4' type="button" value='4'>4</button>
        <button class="operand" name='5' type="button" value='5'>5</button>
        <button class="operand" name='6' type="button" value='6'>6</button><br>
        <button class="operand" name='7' type="button" value='7'>7</button>
        <button class="operand" name='8' type="button" value='8'>8</button>
        <button class="operand" name='9' type="button" value='9'>9</button><br>
        <button class="operand" name="." type="button" value=".">.</button>
        <button class="operand" name='0' type="button" value='0'>0</button>
        <button class="C" id="C" name='C' type="button" value=
        'C'>C</button><br>
        <button id="CE" name='CE' type="button" value='CE'>CE</button>
        <button class="operator" name='+' type="button" value='+'>+</button>
        <button class="operator" name='-' type="button" value=
        '-'>-</button><br>
        <button class="operator" name='/' type="button" value='/'>/</button>
        <button class="operator" name='*' type="button" value='*'>*</button>
        <button class="operator" name='=' type="button" value='='>=</button>
    </div>
</body>
</html>